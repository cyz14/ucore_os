# Lab 8 report: File System

## 练习一

### sfs_io_nolock 读文件中数据

首先检查 offset 是否与数据块对其，如果否的话需要先读取未对齐的部分，然后按照一次一块读取，最后读取可能的不足一块的部分。

### 实现UNIX的PIPE机制

管道是一个内核管理的内存缓冲区，不需要很大。为了支持一个程序从一边输入，另一个程序从另一边读出，需要采用环形缓冲区实现。

管道利用fork机制建立，从而让两个进程可以连接到同一个PIPE上。

可以借助文件系统的file结构和VFS的索引节点inode。通过将两个 file 结构指向同一个临时的 VFS 索引节点，而这个 VFS 索引节点又指向一个物理页面而实现。[参考链接](http://www.cnblogs.com/biyeymyhjob/archive/2012/11/03/2751593.html)

## 练习二

### 实现原理

之前lab中的load_icode从内存中读取改为从文件系统中读取即可，读取时按照elf可执行程序的格式进行检查。

### UNIX的硬链接和软链接机制

系统简单地通过在目录中建立一个新的登记项来实现这种连接。

硬链接：该登记项具有一个新的文件名和要连接文件的inode 号，文件的目录登记项就是所谓的文件硬链接（硬链接，目录登记项： 文件名‐‐>文件的inode；文件名可以有多个，但文件inode 只是一个）。不论一个文件有多少硬链接，在磁盘上只有一个描述它的inode， 只要该文件的链接数不为0，该文件就保持存在。硬链接不能跨越文件系统，为避免无限递归，一般也不能在目录上建立hard link。 硬连接是直接建立在节点表上的（inode），建立硬连接指向一个文件的时候，会更新节点表上面的计数值。

软链接：文件的数据部分仅包含它所要链接文件的路径名。软件有自己的inode，并在磁盘上有一小片空间存放路径名。因此，软链接能够跨文件系统，也可以和目录链接; 其二，软链接可以对一个不存在的文件名进行链接，但直到这个名字对应的文件被创建后，才能打开其链接。当软链接指向的文件删除重命名或移动后，软链接并不会发生更新，会维持原来的值不变。

## 感想

一学期的实验到这里终于结束了，不管过程如何坎坷，结果又将如何，我收获了很多知识，得到了一些有用的技能。

在此感谢老师和助教们的辛勤劳动，认真工作。不足之处还请原谅。